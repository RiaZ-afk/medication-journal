<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Medication Journal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#000; --panel:#111; --text:#fff; --muted:#ccc; --accent:#4CAF50; --border:#333;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Arial, Helvetica, sans-serif; background:var(--bg); color:var(--text);
      min-height:100vh; display:flex;
    }

    /* Sidebar */
    .sidebar{
      width:280px; background:var(--panel); border-right:1px solid var(--border); padding:20px;
      position:sticky; top:0; height:100vh; overflow:auto;
    }
    .sidebar h2{ margin:0 0 10px; font-size:18px; color:var(--accent); }
    .sidebar input,.sidebar select{
      width:100%; padding:8px; margin:0 0 12px; background:#222; color:var(--text); border:1px solid #444; border-radius:6px;
    }
    .entry-list a{
      display:block; padding:8px 6px; border-radius:6px; text-decoration:none; color:var(--text);
    }
    .entry-list a:hover{ background:#1a1a1a; color:var(--accent); }

    /* Main */
    .main{
      flex:1; padding:40px; max-width:1100px; margin-inline:auto;
    }
    h1{ margin:0 0 16px; font-size:28px; }
    .intro{ color:var(--muted); line-height:1.6; max-width:70ch; }

    /* Visitor Map block */
    #visitor-map{
      margin-top:28px; display:flex; justify-content:center; align-items:center;
    }
    .map-card{
      border:1px solid var(--border); border-radius:12px; padding:16px; max-width:360px; width:100%;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));
    }
    .map-card h3{ margin:0 0 10px; font-size:16px; color:var(--accent); text-align:center; }
    .map-embed{
      margin:auto; width:240px; height:240px; display:block;
    }

    /* Responsive */
    @media (max-width:900px){
      body{ flex-direction:column; }
      .sidebar{ position:relative; height:auto; width:100%; border-right:none; border-bottom:1px solid var(--border); }
      .main{ padding:24px; }
      .map-embed{ width:200px; height:200px; }
    }
    @media (max-width:480px){
      .map-embed{ width:160px; height:160px; }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <h2>Entries</h2>
    <input id="search" type="text" placeholder="Search..." />
    <select id="sort">
      <option value="date">Sort by Date</option>
      <option value="name">Sort by Medication Name</option>
    </select>
    <div id="list" class="entry-list"></div>
  </aside>

  <!-- Main content -->
  <main class="main">
    <h1>Medication Journal</h1>
    <p class="intro">
      Welcome! I research one medication each day and summarize the key points—uses, side effects, how it works, and an interesting fact.
      Browse entries on the left, use search/sort, and check out where visitors come from on the map below.
    </p>

    <!-- Visitor Map -->
    <section id="visitor-map" aria-label="Visitor locations">
      <div class="map-card">
        <h3>Visitors Around the World</h3>
        <!-- Globe widget (3D). To use the flat map instead, replace globe.js with map_v2.js (see comment below). -->
        <div class="map-embed">
          <script
            type="text/javascript"
            id="clustrmaps"
            src="https://clustrmaps.com/globe.js?d=1jIiMfl6RvS_QjDfFU3hKEECz3xZYHWJbs_1_LUDXHY">
          </script>
        </div>

        <!--
          Prefer a flat 2D map? Swap the script above for this one:
          <script type="text/javascript" id="clustrmaps" src="https://clustrmaps.com/map_v2.js?d=1jIiMfl6RvS_QjDfFU3hKEECz3xZYHWJbs_1_LUDXHY&cl=ffffff&w=a"></script>
        -->
      </div>
    </section>
  </main>

  <!-- App logic -->
  <script>
    const listEl = document.getElementById('list');
    const sortEl = document.getElementById('sort');
    const searchEl = document.getElementById('search');
    let entries = [];

    // Load entries
    fetch('data.json')
      .then(r => r.json())
      .then(data => { entries = data; render(); })
      .catch(() => { listEl.innerHTML = '<div style="color:#f66">Could not load data.json</div>'; });

    function render(){
      const q = (searchEl.value || '').toLowerCase();
      let rows = entries.filter(e =>
        e.name.toLowerCase().includes(q) || e.date.toLowerCase().includes(q)
      );

      if (sortEl.value === 'name') {
        rows.sort((a,b) => a.name.localeCompare(b.name));
      } else {
        // Assume data.json is chronological (oldest->newest); reverse to show most recent first
        rows = rows.slice().reverse();
      }

      listEl.innerHTML = '';
      rows.forEach(e => {
        const a = document.createElement('a');
        a.href = e.file;
        a.textContent = `${e.date} – ${e.name}`;
        listEl.appendChild(a);
      });
    }

    sortEl.addEventListener('change', render);
    searchEl.addEventListener('input', render);
  </script>
</body>
</html>
